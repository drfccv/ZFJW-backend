# ZFJW Backend API æ¥å£æ–‡æ¡£

ğŸ¯ **é«˜æ ¡æ•™åŠ¡ç³»ç»Ÿåç«¯API**ï¼ŒåŸºäºFlaskæ„å»ºï¼Œæ”¯æŒå¤šæ‰€é«˜æ ¡æ•™åŠ¡ç³»ç»Ÿæ•°æ®è·å–ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

- **æœåŠ¡åœ°å€**: `http://localhost:5000` (å¼€å‘ç¯å¢ƒ)
- **æ”¯æŒå­¦æ ¡**: ä¹æ±Ÿå­¦é™¢ã€å—æ˜ŒèŒä¸šå¤§å­¦
- **æ•°æ®æ ¼å¼**: JSON (Content-Type: application/json)
- **å“åº”æ ¼å¼**: ç»Ÿä¸€JSONç»“æ„

## ğŸ”§ æ¥å£åˆ†ç±»

### HTTPæ–¹æ³•è§„èŒƒ
- **å­¦æ ¡ä¿¡æ¯æ¥å£**: `GET` æ–¹æ³•
- **ä¸šåŠ¡æ•°æ®æ¥å£**: `POST` æ–¹æ³•

---

## ğŸ“š æ¥å£åˆ—è¡¨

### 1. ç³»ç»Ÿå¥åº·æ£€æŸ¥

#### GET `/api/health`
æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "ok",
  "message": "ZFJW Backend API is running"
}
```

---

### 2. å­¦æ ¡ä¿¡æ¯æ¥å£

#### GET `/api/schools`
è·å–æ‰€æœ‰æ”¯æŒçš„å­¦æ ¡åˆ—è¡¨

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–å­¦æ ¡åˆ—è¡¨æˆåŠŸ",
  "data": {
    "count": 2,
    "schools": [
      {
        "school_name": "ä¹æ±Ÿå­¦é™¢",
        "school_code": "jju",
        "description": "ä¹æ±Ÿå­¦é™¢æ•™åŠ¡ç³»ç»Ÿ",
        "requires_captcha": true
      },
      {
        "school_name": "å—æ˜ŒèŒä¸šå¤§å­¦", 
        "school_code": "nvu",
        "description": "å—æ˜ŒèŒä¸šå¤§å­¦æ•™åŠ¡ç³»ç»Ÿ",
        "requires_captcha": false
      }
    ]
  }
}
```

#### GET `/api/school/<school_name>`
è·å–æŒ‡å®šå­¦æ ¡çš„é…ç½®ä¿¡æ¯

**è·¯å¾„å‚æ•°**:
- `school_name`: å­¦æ ¡åç§° (å¦‚: ä¹æ±Ÿå­¦é™¢)

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–å­¦æ ¡é…ç½®æˆåŠŸ",
  "data": {
    "base_url": "https://zhjw1.jju.edu.cn",
    "school_name": "ä¹æ±Ÿå­¦é™¢",
    "school_code": "jju",
    "requires_captcha": true,
    "description": "ä¹æ±Ÿå­¦é™¢æ•™åŠ¡ç³»ç»Ÿ"
  }
}
```

#### GET `/api/school/<school_name>/captcha-required`
æ£€æŸ¥æŒ‡å®šå­¦æ ¡æ˜¯å¦éœ€è¦éªŒè¯ç 

**è·¯å¾„å‚æ•°**:
- `school_name`: å­¦æ ¡åç§°

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "æ£€æŸ¥éªŒè¯ç éœ€æ±‚æˆåŠŸ",
  "data": {
    "school_name": "ä¹æ±Ÿå­¦é™¢",
    "requires_captcha": true
  }
}
```

---

### 3. ç”¨æˆ·è®¤è¯æ¥å£

#### POST `/api/login`
ç”¨æˆ·ç™»å½•æ¥å£

**è¯·æ±‚å‚æ•°**:
```json
{
  "sid": "å­¦å·",
  "password": "å¯†ç ", 
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "cookies": "ç™»å½•å‡­è¯",
    "user_info": "ç”¨æˆ·åŸºæœ¬ä¿¡æ¯"
  }
}
```

#### POST `/api/login_with_kaptcha`
å¸¦éªŒè¯ç çš„ç™»å½•æ¥å£

**è¯·æ±‚å‚æ•°**:
```json
{
  "sid": "å­¦å·",
  "password": "å¯†ç ",
  "captcha": "éªŒè¯ç ",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

#### POST `/api/get_captcha`
è·å–éªŒè¯ç å›¾ç‰‡

**è¯·æ±‚å‚æ•°**:
```json
{
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–éªŒè¯ç æˆåŠŸ",
  "data": {
    "captcha_image": "base64ç¼–ç çš„å›¾ç‰‡æ•°æ®",
    "cookies": "ä¼šè¯å‡­è¯"
  }
}
```

---

### 4. å­¦ç”Ÿä¿¡æ¯æ¥å£

#### POST `/api/info`
è·å–å­¦ç”Ÿä¸ªäººä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–ä¸ªäººä¿¡æ¯æˆåŠŸ",
  "data": {
    "student_id": "å­¦å·",
    "name": "å§“å",
    "college": "å­¦é™¢",
    "major": "ä¸“ä¸š",
    "class": "ç­çº§"
  }
}
```

---

### 5. æˆç»©æŸ¥è¯¢æ¥å£

#### POST `/api/grade`
æŸ¥è¯¢å­¦ç”Ÿæˆç»©

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢",
  "year": "2024",
  "term": "1"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–æˆç»©æˆåŠŸ",
  "data": {
    "courses": [
      {
        "course_name": "è¯¾ç¨‹åç§°",
        "course_code": "è¯¾ç¨‹ä»£ç ", 
        "credit": "å­¦åˆ†",
        "score": "æˆç»©",
        "grade_point": "ç»©ç‚¹"
      }
    ]
  }
}
```

---

### 6. è€ƒè¯•å®‰æ’æ¥å£

#### POST `/api/exam`
æŸ¥è¯¢è€ƒè¯•å®‰æ’

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–è€ƒè¯•å®‰æ’æˆåŠŸ",
  "data": {
    "exams": [
      {
        "course_name": "è¯¾ç¨‹åç§°",
        "exam_time": "è€ƒè¯•æ—¶é—´",
        "exam_location": "è€ƒè¯•åœ°ç‚¹",
        "seat_number": "åº§ä½å·"
      }
    ]
  }
}
```

---

### 7. è¯¾ç¨‹è¡¨æ¥å£

#### POST `/api/schedule`
è·å–è¯¾ç¨‹è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯", 
  "school_name": "ä¹æ±Ÿå­¦é™¢",
  "year": "2024",
  "term": "1"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–è¯¾ç¨‹è¡¨æˆåŠŸ",
  "data": {
    "schedule": [
      {
        "course_name": "è¯¾ç¨‹åç§°",
        "teacher": "æ•™å¸ˆ",
        "classroom": "æ•™å®¤",
        "week": "å‘¨æ¬¡",
        "day": "æ˜ŸæœŸ",
        "time": "èŠ‚æ¬¡"
      }
    ]
  }
}
```

#### POST `/api/schedule_pdf`
è·å–è¯¾ç¨‹è¡¨PDF

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢",
  "year": "2024", 
  "term": "1"
}
```

---

### 8. é€šçŸ¥å…¬å‘Šæ¥å£

#### POST `/api/notifications`
è·å–é€šçŸ¥å…¬å‘Š

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–é€šçŸ¥æˆåŠŸ",
  "data": {
    "notifications": [
      {
        "title": "é€šçŸ¥æ ‡é¢˜",
        "content": "é€šçŸ¥å†…å®¹", 
        "publish_time": "å‘å¸ƒæ—¶é—´",
        "department": "å‘å¸ƒéƒ¨é—¨"
      }
    ]
  }
}
```

---

### 9. å­¦ä¸šæƒ…å†µæ¥å£

#### POST `/api/academia`
è·å–å­¦ä¸šå®Œæˆæƒ…å†µ

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 1000,
  "msg": "è·å–å­¦ä¸šæƒ…å†µæˆåŠŸ",
  "data": {
    "total_credits": "æ€»å­¦åˆ†",
    "completed_credits": "å·²å®Œæˆå­¦åˆ†",
    "remaining_credits": "å‰©ä½™å­¦åˆ†",
    "gpa": "å¹³å‡ç»©ç‚¹"
  }
}
```

---

### 10. é€‰è¯¾ç›¸å…³æ¥å£

#### POST `/api/selected_courses`
æŸ¥è¯¢å·²é€‰è¯¾ç¨‹

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

#### POST `/api/block_courses` 
è·å–è¯¾ç¨‹åˆ†å—ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢"
}
```

#### POST `/api/course_classes`
è·å–è¯¾ç¨‹ç­çº§åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢",
  "course_id": "è¯¾ç¨‹ID"
}
```

#### POST `/api/select_course`
é€‰æ‹©è¯¾ç¨‹

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯",
  "school_name": "ä¹æ±Ÿå­¦é™¢",
  "course_id": "è¯¾ç¨‹ID",
  "class_id": "ç­çº§ID"
}
```

#### POST `/api/drop_course`
é€€é€‰è¯¾ç¨‹

**è¯·æ±‚å‚æ•°**:
```json
{
  "cookies": "ç™»å½•å‡­è¯", 
  "school_name": "ä¹æ±Ÿå­¦é™¢",
  "course_id": "è¯¾ç¨‹ID"
}
```

---

## ğŸ“ é€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 1000,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "msg": "å‚æ•°é”™è¯¯"
}
```

### çŠ¶æ€ç è¯´æ˜
- `1000`: æ“ä½œæˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: è®¤è¯å¤±è´¥
- `404`: èµ„æºä¸å­˜åœ¨
- `999`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å¯åŠ¨æœåŠ¡**
   ```bash
   python app.py
   ```

2. **å¥åº·æ£€æŸ¥**
   ```bash
   curl http://localhost:5000/api/health
   ```

3. **è·å–å­¦æ ¡åˆ—è¡¨**
   ```bash
   curl http://localhost:5000/api/schools
   ```

4. **ç”¨æˆ·ç™»å½•**
   ```bash
   curl -X POST http://localhost:5000/api/login \
     -H "Content-Type: application/json" \
     -d '{"sid":"å­¦å·","password":"å¯†ç ","school_name":"ä¹æ±Ÿå­¦é™¢"}'
   ```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **éªŒè¯ç å¤„ç†**: éƒ¨åˆ†å­¦æ ¡éœ€è¦éªŒè¯ç ï¼Œè¯·å…ˆè°ƒç”¨éªŒè¯ç æ£€æŸ¥æ¥å£
2. **ä¼šè¯ç®¡ç†**: ç™»å½•åè·å¾—çš„cookieséœ€è¦åœ¨åç»­è¯·æ±‚ä¸­æºå¸¦
3. **å­¦æ ¡é…ç½®**: ä¸åŒå­¦æ ¡çš„å‚æ•°å¯èƒ½æœ‰å·®å¼‚ï¼Œè¯·å‚è€ƒå­¦æ ¡é…ç½®æ¥å£
4. **é”™è¯¯å¤„ç†**: è¯·æ ¹æ®è¿”å›çš„çŠ¶æ€ç è¿›è¡Œç›¸åº”çš„é”™è¯¯å¤„ç†
5. **è¯·æ±‚é¢‘ç‡**: é¿å…è¿‡äºé¢‘ç¹çš„è¯·æ±‚ï¼Œä»¥å…è¢«æ•™åŠ¡ç³»ç»Ÿé™åˆ¶

---

## ğŸ”§ å¼€å‘è¯´æ˜

- **æ¡†æ¶**: Flask + Python
- **è·¨åŸŸ**: å·²é…ç½®CORSæ”¯æŒ
- **SSL**: å·²ç¦ç”¨SSLè­¦å‘Šå¤„ç†
- **é…ç½®**: æ”¯æŒå¤šå­¦æ ¡é…ç½®ç®¡ç†
- **æ—¥å¿—**: åŒ…å«è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è¾“å‡º
